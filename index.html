<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tableau de Score</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: sans-serif;
            overflow: hidden;
            touch-action: none; /* Empêche le scroll par défaut pour mieux gérer les gestes */
        }
        .container {
            flex: 1;
            display: flex;
            flex-direction: row;
        }
        .player {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            user-select: none;
        }
        .left {
            background-color: #add8e6; /* Bleu clair pour joueur 1 */
        }
        .right {
            background-color: #ffb6c1; /* Rose clair pour joueur 2 */
        }
        .points {
            font-size: 30vh;
            font-weight: bold;
            font-variant-numeric: tabular-nums;
        }
        .sets {
            font-size: 8vh;
            margin-bottom: 2vh;
            font-variant-numeric: tabular-nums;
        }
        .reset {
            height: 10vh;
            background-color: #808080;
            color: white;
            border: none;
            font-size: 5vh;
            cursor: pointer;
        }
        .reset:active {
            background-color: #606060;
        }
        @media (orientation: portrait) {
            .container {
                flex-direction: column;
            }
            .points {
                font-size: 30vw;
            }
            .sets {
                font-size: 8vw;
                margin-bottom: 2vw;
            }
            .reset {
                height: 15vw;
                font-size: 8vw;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="player left">
            <div class="sets" id="sets1">0</div>
            <div class="points" id="points1">0</div>
        </div>
        <div class="player right">
            <div class="sets" id="sets2">0</div>
            <div class="points" id="points2">0</div>
        </div>
    </div>
    <button class="reset" onclick="resetScores()">Réinitialiser</button>
    <script>
        let points1 = 0;
        let points2 = 0;
        let sets1 = 0;
        let sets2 = 0;

        const points1Elem = document.getElementById('points1');
        const points2Elem = document.getElementById('points2');
        const sets1Elem = document.getElementById('sets1');
        const sets2Elem = document.getElementById('sets2');

        function updateDisplay() {
            points1Elem.innerText = points1;
            points2Elem.innerText = points2;
            sets1Elem.innerText = sets1;
            sets2Elem.innerText = sets2;
        }

        function resetScores() {
            points1 = 0;
            points2 = 0;
            sets1 = 0;
            sets2 = 0;
            updateDisplay();
        }

        function getDigitWidth(elem) {
            const temp = document.createElement('div');
            const style = getComputedStyle(elem);
            temp.style.visibility = 'hidden';
            temp.style.position = 'absolute';
            temp.style.fontSize = style.fontSize;
            temp.style.fontWeight = style.fontWeight;
            temp.style.fontFamily = style.fontFamily;
            temp.innerText = '0';
            document.body.appendChild(temp);
            const width = temp.getBoundingClientRect().width;
            temp.remove();
            return width;
        }

        function animateUpdate(elem, newValue) {
            const oldValueStr = elem.innerText;
            if (oldValueStr === newValue.toString()) return;

            const newValueStr = newValue.toString();
            const maxLen = Math.max(oldValueStr.length, newValueStr.length);
            const oldPadded = oldValueStr.padStart(maxLen, ' ');
            const newPadded = newValueStr.padStart(maxLen, ' ');
            const style = getComputedStyle(elem);
            const rect = elem.getBoundingClientRect();
            const digitWidth = getDigitWidth(elem);
            const digitHeight = rect.height;

            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.flexDirection = 'row';
            container.style.justifyContent = 'center';
            container.style.alignItems = 'center';
            container.style.height = `${digitHeight}px`;

            for (let i = 0; i < maxLen; i++) {
                const oldDigit = oldPadded[i] === ' ' ? '' : oldPadded[i];
                const newDigit = newPadded[i] === ' ' ? '' : newPadded[i];

                const digitCont = document.createElement('div');
                digitCont.style.width = `${digitWidth}px`;
                digitCont.style.height = `${digitHeight}px`;
                digitCont.style.overflow = 'hidden';
                digitCont.style.position = 'relative';

                const roller = document.createElement('div');
                roller.style.transition = 'transform 0.5s ease-in-out';
                roller.style.transform = 'translateY(0)';
                roller.style.display = 'flex';
                roller.style.flexDirection = 'column';

                const topSpan = document.createElement('span');
                topSpan.innerText = oldDigit;
                topSpan.style.height = `${digitHeight}px`;
                topSpan.style.display = 'flex';
                topSpan.style.alignItems = 'center';
                topSpan.style.justifyContent = 'center';
                topSpan.style.fontSize = style.fontSize;
                topSpan.style.fontWeight = style.fontWeight;
                topSpan.style.color = style.color;
                topSpan.style.lineHeight = style.lineHeight;

                const bottomSpan = document.createElement('span');
                bottomSpan.innerText = newDigit;
                bottomSpan.style.height = `${digitHeight}px`;
                bottomSpan.style.display = 'flex';
                bottomSpan.style.alignItems = 'center';
                bottomSpan.style.justifyContent = 'center';
                bottomSpan.style.fontSize = style.fontSize;
                bottomSpan.style.fontWeight = style.fontWeight;
                bottomSpan.style.color = style.color;
                bottomSpan.style.lineHeight = style.lineHeight;

                roller.appendChild(topSpan);
                roller.appendChild(bottomSpan);
                digitCont.appendChild(roller);
                container.appendChild(digitCont);

                if (oldDigit !== newDigit) {
                    setTimeout(() => {
                        roller.style.transform = `translateY(-${digitHeight}px)`;
                    }, 10);
                }
            }

            elem.innerHTML = '';
            elem.appendChild(container);

            setTimeout(() => {
                elem.innerText = newValueStr;
            }, 500);
        }

        function setupSwipeHandler(element, isPlayer1) {
            let startX = 0;
            let startY = 0;

            element.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });

            element.addEventListener('touchend', (e) => {
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const deltaX = endX - startX;
                const deltaY = endY - startY;
                const threshold = 50; // Seuil pour détecter un glissement significatif

                if (Math.abs(deltaY) > threshold && Math.abs(deltaX) < threshold && deltaY < 0) {
                    // Glissement vers le haut : +1 au score principal (points)
                    if (isPlayer1) {
                        points1++;
                        animateUpdate(points1Elem, points1);
                    } else {
                        points2++;
                        animateUpdate(points2Elem, points2);
                    }
                } else if (Math.abs(deltaX) > threshold && Math.abs(deltaY) < threshold && deltaX > 0) {
                    // Glissement vers la droite : +1 au score secondaire (sets)
                    if (isPlayer1) {
                        sets1++;
                        animateUpdate(sets1Elem, sets1);
                    } else {
                        sets2++;
                        animateUpdate(sets2Elem, sets2);
                    }
                }
            });
        }

        const leftPlayer = document.querySelector('.left');
        const rightPlayer = document.querySelector('.right');

        setupSwipeHandler(leftPlayer, true);
        setupSwipeHandler(rightPlayer, false);
    </script>
</body>
</html>
